load("//lib/tests/write_source_files:write_source_files_test.bzl", "write_source_files_test")
load("//lib:write_source_files.bzl", "write_source_files")
load("//lib:copy_to_directory.bzl", "copy_to_directory")

genrule(
    name = "a-desired",
    outs = ["a-desired.js"],
    cmd = "echo 'console.log(\"a*\")' > $@",
)

genrule(
    name = "b-desired",
    outs = ["b-desired.js"],
    cmd = "echo 'console.log(\"b*\")' > $@",
)

genrule(
    name = "g-desired",
    outs = ["g/g.js"],  # Generated in a subdirectory
    cmd = "echo 'console.log(\"g*\")' > $@",
)

filegroup(
    name = "fg-group",
    srcs = [
        ":g-desired",
        "//lib/tests/write_source_files/subdir:f-desired",
    ],
)

genrule(
    name = "e",
    outs = ["e.js"],
    cmd = "echo 'console.log(\"e*\")' > $@",
)

copy_to_directory(
    name = "e_dir-desired",
    srcs = [":e"],
)

write_source_files_test(
    name = "write_to_source_files_test",
    in_files = [
        ":a-desired",
        ":b-desired",
    ],
    out_files = [
        "a.js",
        "b.js",
    ],
)

write_source_files(
    name = "macro_smoke_test",
    additional_update_targets = [
        "//lib/tests/write_source_files/subdir:macro_smoke_test",
    ],
    files = {
        "a2.js": ":a-desired",
        "b2.js": ":b-desired",
        "e_dir": ":e_dir-desired",
    },
    include_files = [
        ":fg-group",
    ],
)
